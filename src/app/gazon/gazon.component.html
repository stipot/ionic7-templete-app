<!-- заголовок -->
<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>
      <ion-icon name="sync" class="ion-margin-end"></ion-icon>
      Конвертер файлов
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding" fullscreen>
  <!-- приветственная карточка -->
  <div class="welcome-section">
    <ion-card class="welcome-card animated-card">
      <ion-card-header>
        <ion-card-title class="welcome-title">
          <ion-icon name="sync" color="primary" class="pulse-icon"></ion-icon>
          Конвертер форматов файлов
        </ion-card-title>
        <ion-card-subtitle>Простой и удобный инструмент для конвертации</ion-card-subtitle>
      </ion-card-header>

      <ion-card-content>
        <p class="welcome-text">
          Добро пожаловать в современный конвертер файлов! 
          Этот инструмент создан для того, чтобы сделать процесс конвертации файлов максимально простым, понятным и удобным в использовании.
        </p>
        
        <ion-grid class="features-grid">
          <ion-row>
            <ion-col size="12" size-md="4">
              <div class="feature-item">
                <ion-icon name="cloud-upload" color="primary" class="feature-icon"></ion-icon>
                <h3>Загрузите файл</h3>
                <p>Формат определится автоматически</p>
              </div>
            </ion-col>
            <ion-col size="12" size-md="4">
              <div class="feature-item">
                <ion-icon name="document" color="primary" class="feature-icon"></ion-icon>
                <h3>Выберите формат</h3>
                <p>В какой формат конвертировать</p>
              </div>
            </ion-col>
            <ion-col size="12" size-md="4">
              <div class="feature-item">
                <ion-icon name="download" color="primary" class="feature-icon"></ion-icon>
                <h3>Скачайте результат</h3>
                <p>Получите готовый файл!</p>
              </div>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- секция загрузки файла -->
  <ion-card class="upload-card animated-card">
    <ion-card-header>
      <ion-card-title class="section-title">
        <ion-icon name="document" color="primary"></ion-icon>
        Выбор файла
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <!-- область drag and drop -->
      <div 
        class="drop-zone" 
        [class.drag-over]="isDragOver"
        (drop)="onFileDrop($event)"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (click)="fileInput.click()">
        
        <div class="drop-content" *ngIf="!selectedFile">
          <ion-icon name="cloud-upload-outline" class="drop-icon"></ion-icon>
          <h3>Перетащите файл сюда или нажмите для выбора</h3>
          <p>Поддерживаются изображения, документы и текстовые файлы</p>
        </div>

        <div class="file-preview" *ngIf="selectedFile">
          <ion-icon [name]="getFileIcon(selectedFile.type)" class="file-icon"></ion-icon>
          <div class="file-info">
            <h3>{{ selectedFile.name }}</h3>
            <p>{{ fileSize }} • {{ selectedFile.type || 'Тип не определен' }}</p>
            <p class="format-badge">формат: {{ sourceFormat ? sourceFormat.toUpperCase() : 'не определен' }}</p>
          </div>
          <ion-button fill="clear" color="medium" (click)="clearFile(); $event.stopPropagation()">
            <ion-icon name="close-circle"></ion-icon>
          </ion-button>
        </div>
      </div>

      <input 
        #fileInput
        type="file" 
        (change)="onFileSelected($event)"
        accept="image/*, .pdf, .doc, .docx, .txt, .rtf"
        class="file-input"
      >
    </ion-card-content>
  </ion-card>

  <!-- секция выбора форматов -->
  <ion-card class="formats-card animated-card" *ngIf="selectedFile">
    <ion-card-header>
      <ion-card-title class="section-title">
        <ion-icon name="options" color="primary"></ion-icon>
        Настройки конвертации
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col size="12" size-md="6">
            <!-- исходный формат -->
            <ion-item class="format-item" lines="none">
              <ion-icon name="arrow-down" slot="start" color="primary"></ion-icon>
              <ion-label position="stacked">Исходный формат</ion-label>
              <ion-select 
                [(ngModel)]="sourceFormat" 
                interface="action-sheet"
                [disabled]="true">
                <ion-select-option [value]="sourceFormat">
                  {{ sourceFormat ? sourceFormat.toUpperCase() + ' (авто)' : 'не выбран' }}
                </ion-select-option>
              </ion-select>
            </ion-item>
          </ion-col>
          
          <ion-col size="12" size-md="6">
            <!-- целевой формат -->
            <ion-item class="format-item" lines="none">
              <ion-icon name="arrow-forward" slot="start" color="primary"></ion-icon>
              <ion-label position="stacked">Целевой формат</ion-label>
              <ion-select 
                [(ngModel)]="targetFormat" 
                placeholder="выберите формат"
                interface="action-sheet">
                <ion-select-option value="jpg">JPG (изображение)</ion-select-option>
                <ion-select-option value="png">PNG (изображение)</ion-select-option>
                <ion-select-option value="webp">WebP (изображение)</ion-select-option>
                <ion-select-option value="gif">GIF (изображение)</ion-select-option>
                <ion-select-option value="bmp">BMP (изображение)</ion-select-option>
                <ion-select-option value="svg">SVG (вектор)</ion-select-option>
                <ion-select-option value="pdf">PDF (документ)</ion-select-option>
                <ion-select-option value="txt">TXT (текст)</ion-select-option>
                <ion-select-option value="doc">DOC (документ)</ion-select-option>
              </ion-select>
            </ion-item>
          </ion-col>
        </ion-row>
      </ion-grid>

      <!-- информация о конвертации -->
      <div *ngIf="sourceFormat && targetFormat" class="conversion-info">
        <ion-item lines="none" class="info-item">
          <ion-icon name="information-circle" slot="start" color="primary"></ion-icon>
          <ion-label>
            <h3>Конвертация: {{ sourceFormat | uppercase }} → {{ targetFormat | uppercase }}</h3>
            <p>Готово к преобразованию файла</p>
          </ion-label>
        </ion-item>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- кнопка конвертации -->
  <div class="action-buttons" *ngIf="selectedFile">
    <ion-button 
      expand="block" 
      (click)="convertFile()" 
      [disabled]="!selectedFile || !sourceFormat || !targetFormat || isLoading"
      size="large"
      class="convert-button"
      shape="round">
      <ion-icon name="sync" slot="start" *ngIf="!isLoading"></ion-icon>
      <ion-spinner name="crescent" *ngIf="isLoading" slot="start"></ion-spinner>
      {{ isLoading ? 'Идет конвертация...' : 'Конвертировать файл' }}
    </ion-button>

    <!-- кнопка скачивания -->
    <ion-button 
      *ngIf="downloadUrl"
      expand="block" 
      (click)="downloadConvertedFile()" 
      color="success"
      size="large"
      class="download-button ion-margin-top">
      <ion-icon name="download" slot="start"></ion-icon>
      Скачать сконвертированный файл
    </ion-button>
  </div>

  <!-- сообщение о результате -->
  <div *ngIf="conversionResult" class="result-message">
    <ion-card [class]="conversionResult.success ? 'success-card' : 'error-card'" class="animated-card">
      <ion-card-content>
        <ion-item lines="none">
          <ion-icon 
            [name]="conversionResult.success ? 'checkmark-circle' : 'alert-circle'" 
            slot="start"
            [color]="conversionResult.success ? 'success' : 'danger'">
          </ion-icon>
          <ion-label class="ion-text-wrap">
            <h3>{{ conversionResult.success ? 'Успешно!' : 'Ошибка' }}</h3>
            <p>{{ conversionResult.message }}</p>
          </ion-label>
        </ion-item>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>